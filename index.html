<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta name="description" content="■">
	<meta name="keywords" content="■">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0">
	<link rel="stylesheet" href="css/import.css">
	<script src="js/jquery.js"></script>
	<script src="js/common.js"></script>
	<script src="js/jquery.preload.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			var url = 'https://api.flickr.com/services/rest/';
			var key = 'e2d99c3ff7885e30c624973bb84fdb09';
			var itemLimit = 40;
			var page = 1;
			var usr = '126218952@N06';
			var tags = window.location.search;
			var showSumNum = 0;

			function pageCounter(p) {
				var count = p;
				return function() {
					return count++;
				}
			}
			sumObj = pageCounter(2);

			function preloadComplate(e) {
				$('body').removeClass("load");

				for(var i = 0;i < e.imgs.length;i++) {
					$('#FlickrPhotos').append('<li class="off"><a href="' + e.imgs[i].replace("_s","") + '"><img src="' + e.imgs[i] + '"></a></li>');
					setTimeout(function () {
						$('#FlickrPhotos li').eq(showSumNum).removeClass("off");
						showSumNum++
					 },i*10);
				}
			}

			//get Tag
			function getTags() {
				$.ajax({
					type: 'GET',
					url: url+'?method=flickr.tags.getListUser&api_key='+key+'&user_id='+usr+'&format=json&nojsoncallback=1',
					dataType: 'json',
					success : function(tags){
						console.log(tags);
					}
				})
			}

			//get Photo
			function getPhoto(c) {
				page = !c ? page :c;

				$.ajax({
					type: 'GET',
					url: url+'?method=flickr.photos.search&api_key='+key+'&per_page='+itemLimit+'&page='+page+'+&user_id='+usr+'&format=json&nojsoncallback=1',
					dataType: 'json',
					success: function(json){
						console.log(json);
						var imgPath = [];
						for ( i=0; i < json.photos.photo.length; i ++ ) {
							var farm = json.photos.photo[i].farm;
							var server = json.photos.photo[i].server;
							var secret = json.photos.photo[i].secret;
							var id = json.photos.photo[i].id;
							imgPath[i] = 'http://farm'+farm+'.staticflickr.com/'+server+'/'+id+'_'+secret+'_s.jpg';
						}
						$(window).preload({
							imgs : imgPath,
							onComplete : function(e){preloadComplate(e);},
							loadFunction : function(e){},
							timerSpeed : 10
						});
					}
				});
			}

		

			getTags();
			getPhoto();
			$("body").addClass("load");

			$('p.nextbtn').click(function() {
				getPhoto(sumObj());
				$("body").addClass("load");
			});
});
	</script>
	<title>■</title>
</head>
<body>
<form>
<input type="text">
<input type="submit" value="Seach">
</form>
<ul id="FlickrPhotos">
</ul>
<p class="nextbtn">次の20件を表示</p>
</body>
</html>